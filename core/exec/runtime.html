
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Runtime Structure &#8212; WebAssembly 1.1</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"MAXBUFFER": 30720}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Numerics" href="numerics.html" />
    <link rel="prev" title="Conventions" href="conventions.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/webassembly.png" alt="Logo"/>
            </a></p><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syntax/index.html">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../valid/index.html">Validation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Execution</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="conventions.html">Conventions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Runtime Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="numerics.html">Numerics</a></li>
<li class="toctree-l2"><a class="reference internal" href="instructions.html">Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="relaxed.html">Relaxed Memory Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../binary/index.html">Binary Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../text/index.html">Text Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index-types.html">Index of Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index-instructions.html">Index of Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index-rules.html">Index of Semantic Rules</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="../genindex.html">Index</a></li>
    
    <li class="toctree-l1"><a href="../_download/WebAssembly.pdf">Download as PDF</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="runtime-structure">
<span id="syntax-runtime"></span><span id="index-0"></span><h1>Runtime Structure<a class="headerlink" href="#runtime-structure" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="#store"><span class="std std-ref">Store</span></a>, <a class="reference internal" href="#stack"><span class="std std-ref">stack</span></a>, and other <em>runtime structure</em> forming the WebAssembly abstract machine, such as <a class="reference internal" href="#syntax-val"><span class="std std-ref">values</span></a> or <a class="reference internal" href="#syntax-moduleinst"><span class="std std-ref">module instances</span></a>, are made precise in terms of additional auxiliary syntax.</p>
<div class="section" id="values">
<span id="syntax-val"></span><span id="index-1"></span><h2>Values<a class="headerlink" href="#values" title="Permalink to this headline">¶</a></h2>
<p>WebAssembly computations manipulate <em>values</em> of the four basic <a class="reference internal" href="../syntax/types.html#syntax-valtype"><span class="std std-ref">value types</span></a>: <a class="reference internal" href="../syntax/values.html#syntax-int"><span class="std std-ref">integers</span></a> and <a class="reference internal" href="../syntax/values.html#syntax-float"><span class="std std-ref">floating-point data</span></a> of 32 or 64 bit width each, respectively.</p>
<p>In most places of the semantics, values of different types can occur.
In order to avoid ambiguities, values are therefore represented with an abstract syntax that makes their type explicit.
It is convenient to reuse the same notation as for the <span class="math notranslate nohighlight">\(\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}\)</span> <a class="reference internal" href="../syntax/instructions.html#syntax-const"><span class="std std-ref">instructions</span></a> producing them:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llcl}
\def\mathdef1548#1{{}}\mathdef1548{(value)} &amp; \href{../exec/runtime.html#syntax-val}{\mathit{val}} &amp;::=&amp;
  \href{../syntax/types.html#syntax-valtype}{\mathsf{i32}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~\href{../syntax/values.html#syntax-int}{\mathit{i32}} \\&amp;&amp;|&amp;
  \href{../syntax/types.html#syntax-valtype}{\mathsf{i64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~\href{../syntax/values.html#syntax-int}{\mathit{i64}} \\&amp;&amp;|&amp;
  \href{../syntax/types.html#syntax-valtype}{\mathsf{f32}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~\href{../syntax/values.html#syntax-float}{\mathit{f32}} \\&amp;&amp;|&amp;
  \href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~\href{../syntax/values.html#syntax-float}{\mathit{f64}}
\end{array}\end{split}\]</div>
</div>
<div class="section" id="results">
<span id="syntax-result"></span><span id="index-2"></span><h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<p>A <em>result</em> is the outcome of a computation.
It is either a sequence of <a class="reference internal" href="#syntax-val"><span class="std std-ref">values</span></a> or a <a class="reference internal" href="#syntax-trap"><span class="std std-ref">trap</span></a>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llcl}
\def\mathdef1548#1{{}}\mathdef1548{(result)} &amp; \href{../exec/runtime.html#syntax-result}{\mathit{result}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast \\&amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-trap}{\mathsf{trap}}
\end{array}\end{split}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the current version of WebAssembly, a result can consist of at most one value.</p>
</div>
</div>
<div class="section" id="addresses">
<span id="syntax-addr"></span><span id="syntax-globaladdr"></span><span id="syntax-memaddr"></span><span id="syntax-tableaddr"></span><span id="syntax-funcaddr"></span><span id="index-3"></span><h2>Addresses<a class="headerlink" href="#addresses" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">Function instances</span></a>, <a class="reference internal" href="#syntax-tableinst"><span class="std std-ref">table instances</span></a>, <a class="reference internal" href="#syntax-meminst"><span class="std std-ref">memory instances</span></a>, and <a class="reference internal" href="#syntax-globalinst"><span class="std std-ref">global instances</span></a> in the <a class="reference internal" href="#syntax-store"><span class="std std-ref">store</span></a> are referenced with abstract <em>addresses</em>.
Each address uniquely determines a respective component in the store.
Other than that the form that addresses take is unspecified and cannot be observed.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(address)} &amp; \href{../exec/runtime.html#syntax-addr}{\mathit{addr}} &amp;::=&amp;
  \dots \\
\def\mathdef1548#1{{}}\mathdef1548{(function address)} &amp; \href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-addr}{\mathit{addr}} \\
\def\mathdef1548#1{{}}\mathdef1548{(table address)} &amp; \href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-addr}{\mathit{addr}} \\
\def\mathdef1548#1{{}}\mathdef1548{(memory address)} &amp; \href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-addr}{\mathit{addr}} \\
\def\mathdef1548#1{{}}\mathdef1548{(global address)} &amp; \href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-addr}{\mathit{addr}} \\
\end{array}\end{split}\]</div>
<p>An <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a> may assign identity to <a class="reference internal" href="../syntax/modules.html#syntax-export"><span class="std std-ref">exported</span></a> store objects corresponding to their addresses,
even where this identity is not observable from within WebAssembly code itself
(such as for <a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">function instances</span></a> or immutable <a class="reference internal" href="#syntax-globalinst"><span class="std std-ref">globals</span></a>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Addresses are <em>dynamic</em>, globally unique references to runtime objects,
in contrast to <a class="reference internal" href="../syntax/modules.html#syntax-index"><span class="std std-ref">indices</span></a>,
which are <em>static</em>, module-local references to their original definitions.
A <em>memory address</em> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}\)</span> denotes the abstract address <em>of</em> a memory <em>instance</em> in the store,
not an offset <em>inside</em> a memory instance.</p>
</div>
</div>
<div class="section" id="time-stamps">
<span id="relaxed-prechb"></span><span id="syntax-time"></span><span id="index-4"></span><h2>Time Stamps<a class="headerlink" href="#time-stamps" title="Permalink to this headline">¶</a></h2>
<p>In order to track the relative ordering in the execution of multiple <a class="reference internal" href="#syntax-thread"><span class="std std-ref">threads</span></a> and the occurrence of <a class="reference internal" href="#syntax-evt"><span class="std std-ref">events</span></a>,
the semantics uses a notion of abstract <em>time stamps</em>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(time stamp)} &amp; \href{../exec/runtime.html#syntax-time}{\mathit{time}} &amp;::=&amp;
  \dots \\
\end{array}\end{split}\]</div>
<p>Each time stamp denotes a discrete point in time, and is drawn from an infinite set.
The shape of time stamps is not specified or observable.
However, time stamps form a partially ordered set:
a time stamp <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-time}{\mathit{time}}_1\)</span> <em>happens before</em> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-time}{\mathit{time}}_2\)</span>, written <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-time}{\mathit{time}}_1 \href{../exec/relaxed.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} \href{../exec/runtime.html#syntax-time}{\mathit{time}}_2\)</span>, if it is known to have occurred earlier in time.</p>
<div class="admonition-todo admonition" id="id1">
<span id="relaxed-prectot"></span><p class="admonition-title">Todo</p>
<p>define prectot here as well?</p>
</div>
<div class="section" id="conventions">
<span id="notation-attime"></span><h3>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The meta variable <span class="math notranslate nohighlight">\(h\)</span> ranges over time stamps where clear from context.</p></li>
<li><p>The notation <span class="math notranslate nohighlight">\((X~\href{../exec/runtime.html#syntax-time}{\mathsf{at}}~\href{../exec/runtime.html#syntax-time}{\mathit{time}})\)</span> is a shorthand for the <a class="reference internal" href="../syntax/conventions.html#notation-record"><span class="std std-ref">record</span></a> <span class="math notranslate nohighlight">\(\{\href{../exec/runtime.html#syntax-time}{\mathsf{val}}~X, \href{../exec/runtime.html#syntax-time}{\mathsf{time}}~\href{../exec/runtime.html#syntax-time}{\mathit{time}}\}\)</span> that annotates a semantic object <span class="math notranslate nohighlight">\(X\)</span> with a time stamp <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-time}{\mathit{time}}\)</span>.</p></li>
</ul>
</div>
</div>
<div class="section" id="store">
<span id="index-5"></span><span id="id2"></span><h2>Store<a class="headerlink" href="#store" title="Permalink to this headline">¶</a></h2>
<p>A <em>store</em> represents state that can be manipulated by WebAssembly programs.
The overall state of the WebAssembly abstract machine can consist of multiple disjoint stores,
separated into per-<a class="reference internal" href="#syntax-thread"><span class="std std-ref">thread</span></a> <em>local stores</em> and a single <em>shared store</em>. <a class="footnote-reference brackets" href="#cite-oopsla2019" id="id3">2</a></p>
<div class="section" id="local-store">
<span id="syntax-store"></span><h3>Local Store<a class="headerlink" href="#local-store" title="Permalink to this headline">¶</a></h3>
<p>A <em>local store</em> represents all state that can be manipulated by programs within a single <a class="reference internal" href="#syntax-thread"><span class="std std-ref">thread</span></a>.
It consists of the runtime representation of all <em>instances</em> of <a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">functions</span></a>, <a class="reference internal" href="#syntax-tableinst"><span class="std std-ref">tables</span></a>, <a class="reference internal" href="#syntax-meminst"><span class="std std-ref">memories</span></a>, and <a class="reference internal" href="#syntax-globalinst"><span class="std std-ref">globals</span></a> that have been <a class="reference internal" href="modules.html#alloc"><span class="std std-ref">allocated</span></a> during the life time of that thread. <a class="footnote-reference brackets" href="#gc" id="id4">1</a></p>
<p>Syntactically, a local store is defined as a <a class="reference internal" href="../syntax/conventions.html#notation-map"><span class="std std-ref">map</span></a> from known <a class="reference internal" href="#syntax-addr"><span class="std std-ref">addresses</span></a> to the allocated instances of each category:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(store)} &amp; \href{../exec/runtime.html#syntax-store}{\mathit{store}} &amp;::=&amp;
  (\href{../exec/runtime.html#syntax-addr}{\mathit{addr}} \mapsto \href{../exec/runtime.html#syntax-store}{\mathit{inst}})^\ast \\
\def\mathdef1548#1{{}}\mathdef1548{(instance)} &amp; \href{../exec/runtime.html#syntax-store}{\mathit{inst}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-funcinst}{\mathit{funcinst}} ~|~
  \href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}} ~|~
  \href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}} ~|~
  \href{../exec/runtime.html#syntax-globalinst}{\mathit{globalinst}} \\
\end{array}\end{split}\]</div>
<p>It is an invariant of the semantics that none of the memory instances <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}\)</span> in a store is <span class="math notranslate nohighlight">\(shared &lt;syntax-shared&gt;\)</span>.</p>
<dl class="footnote brackets">
<dt class="label" id="gc"><span class="brackets"><a class="fn-backref" href="#id4">1</a></span></dt>
<dd><p>In practice, implementations may apply techniques like garbage collection to remove objects from the store that are no longer referenced.
However, such techniques are not semantically observable,
and hence outside the scope of this specification.</p>
</dd>
</dl>
</div>
<div class="section" id="shared-store">
<span id="sharedstore"></span><span id="syntax-sharedstore"></span><span id="index-6"></span><h3>Shared Store<a class="headerlink" href="#shared-store" title="Permalink to this headline">¶</a></h3>
<p>The <em>shared store</em> represents all global state that can be shared between multiple <a class="reference internal" href="#syntax-thread"><span class="std std-ref">threads</span></a>.
It consists of the runtime representation of all <em>instances</em> of <a class="reference internal" href="../syntax/types.html#syntax-shared"><span class="std std-ref">shared</span></a> <a class="reference internal" href="#syntax-meminst"><span class="std std-ref">memories</span></a> that have been <a class="reference internal" href="modules.html#alloc"><span class="std std-ref">allocated</span></a> by any thread during the life time of the abstract machine.</p>
<p>Syntactically, the shared store is defined as a <a class="reference internal" href="../syntax/conventions.html#notation-map"><span class="std std-ref">map</span></a> from known <a class="reference internal" href="#syntax-addr"><span class="std std-ref">addresses</span></a> to instances <a class="reference internal" href="#notation-attime"><span class="std std-ref">annotated</span></a> with the <a class="reference internal" href="#syntax-time"><span class="std std-ref">time</span></a> of their creation.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(shared store)} &amp; \href{../exec/runtime.html#syntax-sharedstore}{\mathit{sharedstore}} &amp;::=&amp;
  (\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}} \mapsto \href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}} \href{../exec/runtime.html#syntax-time}{\mathsf{at}} \href{../exec/runtime.html#syntax-time}{\mathit{time}})^\ast, \\
\end{array}\end{split}\]</div>
<p>It is an invariant of the semantics that all memory instances <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}\)</span> in a shared store are <span class="math notranslate nohighlight">\(shared &lt;syntax-shared&gt;\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In future versions of WebAssembly, other entities than just memories may be sharable and contained in a shared store.</p>
</div>
</div>
<div class="section" id="id5">
<h3>Conventions<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The meta variable <span class="math notranslate nohighlight">\(S\)</span> ranges over local stores where clear from context.</p></li>
<li><p>The meta variable <span class="math notranslate nohighlight">\(\mathit{SS}\)</span> ranges over shared stores where clear from context.</p></li>
</ul>
</div>
</div>
<div class="section" id="module-instances">
<span id="syntax-moduleinst"></span><span id="index-7"></span><h2>Module Instances<a class="headerlink" href="#module-instances" title="Permalink to this headline">¶</a></h2>
<p>A <em>module instance</em> is the runtime representation of a <a class="reference internal" href="../syntax/modules.html#syntax-module"><span class="std std-ref">module</span></a>.
It is created by <a class="reference internal" href="modules.html#exec-instantiation"><span class="std std-ref">instantiating</span></a> a module,
and collects runtime representations of all entities that are imported, defined, or exported by the module.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(module instance)} &amp; \href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}} &amp;::=&amp; \{
  \begin{array}[t]{l&#64;{~}ll}
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{types}} &amp; \href{../syntax/types.html#syntax-functype}{\mathit{functype}}^\ast, \\
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{funcaddrs}} &amp; \href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}^\ast, \\
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{tableaddrs}} &amp; \href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}^\ast, \\
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{memaddrs}} &amp; \href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}^\ast, \\
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{globaladdrs}} &amp; \href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}^\ast, \\
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{exports}} &amp; \href{../exec/runtime.html#syntax-exportinst}{\mathit{exportinst}}^\ast ~\} \\
  \end{array}
\end{array}\end{split}\]</div>
<p>Each component references runtime instances corresponding to respective declarations from the original module – whether imported or defined – in the order of their static <a class="reference internal" href="../syntax/modules.html#syntax-index"><span class="std std-ref">indices</span></a>.
<a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">Function instances</span></a>, <a class="reference internal" href="#syntax-tableinst"><span class="std std-ref">table instances</span></a>, <a class="reference internal" href="#syntax-meminst"><span class="std std-ref">memory instances</span></a>, and <a class="reference internal" href="#syntax-globalinst"><span class="std std-ref">global instances</span></a> are referenced with an indirection through their respective <a class="reference internal" href="#syntax-addr"><span class="std std-ref">addresses</span></a> in the <a class="reference internal" href="#syntax-store"><span class="std std-ref">store</span></a>.</p>
<p>It is an invariant of the semantics that all <a class="reference internal" href="#syntax-exportinst"><span class="std std-ref">export instances</span></a> in a given module instance have different <a class="reference internal" href="../syntax/values.html#syntax-name"><span class="std std-ref">names</span></a>.</p>
</div>
<div class="section" id="function-instances">
<span id="syntax-funcinst"></span><span id="syntax-hostfunc"></span><span id="index-8"></span><h2>Function Instances<a class="headerlink" href="#function-instances" title="Permalink to this headline">¶</a></h2>
<p>A <em>function instance</em> is the runtime representation of a <a class="reference internal" href="../syntax/modules.html#syntax-func"><span class="std std-ref">function</span></a>.
It effectively is a <em>closure</em> of the original function over the runtime <a class="reference internal" href="#syntax-moduleinst"><span class="std std-ref">module instance</span></a> of its originating <a class="reference internal" href="../syntax/modules.html#syntax-module"><span class="std std-ref">module</span></a>.
The module instance is used to resolve references to other definitions during execution of the function.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(function instance)} &amp; \href{../exec/runtime.html#syntax-funcinst}{\mathit{funcinst}} &amp;::=&amp;
  \{ \href{../exec/runtime.html#syntax-funcinst}{\mathsf{type}}~\href{../syntax/types.html#syntax-functype}{\mathit{functype}}, \href{../exec/runtime.html#syntax-funcinst}{\mathsf{module}}~\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}, \href{../exec/runtime.html#syntax-funcinst}{\mathsf{code}}~\href{../syntax/modules.html#syntax-func}{\mathit{func}} \} \\ &amp;&amp;|&amp;
  \{ \href{../exec/runtime.html#syntax-funcinst}{\mathsf{type}}~\href{../syntax/types.html#syntax-functype}{\mathit{functype}}, \href{../exec/runtime.html#syntax-funcinst}{\mathsf{hostcode}}~\href{../exec/runtime.html#syntax-hostfunc}{\mathit{hostfunc}} \} \\
\def\mathdef1548#1{{}}\mathdef1548{(host function)} &amp; \href{../exec/runtime.html#syntax-hostfunc}{\mathit{hostfunc}} &amp;::=&amp; \dots \\
\end{array}\end{split}\]</div>
<div class="admonition-todo admonition" id="id6">
<p class="admonition-title">Todo</p>
<p>need to represent host functions differently to encompass threading</p>
</div>
<p>A <em>host function</em> is a function expressed outside WebAssembly but passed to a <a class="reference internal" href="../syntax/modules.html#syntax-module"><span class="std std-ref">module</span></a> as an <a class="reference internal" href="../syntax/modules.html#syntax-import"><span class="std std-ref">import</span></a>.
The definition and behavior of host functions are outside the scope of this specification.
For the purpose of this specification, it is assumed that when <a class="reference internal" href="instructions.html#exec-invoke-host"><span class="std std-ref">invoked</span></a>,
a host function behaves non-deterministically,
but within certain <a class="reference internal" href="instructions.html#exec-invoke-host"><span class="std std-ref">constraints</span></a> that ensure the integrity of the runtime.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Function instances are immutable, and their identity is not observable by WebAssembly code.
However, the <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a> might provide implicit or explicit means for distinguishing their <a class="reference internal" href="#syntax-funcaddr"><span class="std std-ref">addresses</span></a>.</p>
</div>
</div>
<div class="section" id="table-instances">
<span id="syntax-tableinst"></span><span id="syntax-funcelem"></span><span id="index-9"></span><h2>Table Instances<a class="headerlink" href="#table-instances" title="Permalink to this headline">¶</a></h2>
<p>A <em>table instance</em> is the runtime representation of a <a class="reference internal" href="../syntax/modules.html#syntax-table"><span class="std std-ref">table</span></a>.
It holds a vector of <em>function elements</em> and an optional maximum size, if one was specified in the <a class="reference internal" href="../syntax/types.html#syntax-tabletype"><span class="std std-ref">table type</span></a> at the table’s definition site.</p>
<p>Each function element is either empty, representing an uninitialized table entry, or a <a class="reference internal" href="#syntax-funcaddr"><span class="std std-ref">function address</span></a>.
Function elements can be mutated through the execution of an <a class="reference internal" href="../syntax/modules.html#syntax-elem"><span class="std std-ref">element segment</span></a> or by external means provided by the <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(table instance)} &amp; \href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}} &amp;::=&amp;
  \{ \href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}~\href{../syntax/conventions.html#syntax-vec}{\mathit{vec}}(\href{../exec/runtime.html#syntax-funcelem}{\mathit{funcelem}}), \href{../exec/runtime.html#syntax-tableinst}{\mathsf{max}}~\href{../syntax/values.html#syntax-int}{\mathit{u32}}^? \} \\
\def\mathdef1548#1{{}}\mathdef1548{(function element)} &amp; \href{../exec/runtime.html#syntax-funcelem}{\mathit{funcelem}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}^? \\
\end{array}\end{split}\]</div>
<p>It is an invariant of the semantics that the length of the element vector never exceeds the maximum size, if present.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Other table elements may be added in future versions of WebAssembly.</p>
</div>
</div>
<div class="section" id="memory-instances">
<span id="syntax-meminst"></span><span id="page-size"></span><span id="index-10"></span><h2>Memory Instances<a class="headerlink" href="#memory-instances" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id7">
<p class="admonition-title">Todo</p>
<p>We used to update the memory type when a memory is grown. This does not work for shared memories. In fact, the “current” type of a shared memory is nondeterministic. We need to model that during instantiation somehow.</p>
</div>
<p>A <em>memory instance</em> is the runtime representation of a linear <a class="reference internal" href="../syntax/modules.html#syntax-mem"><span class="std std-ref">memory</span></a>.
It records its original <a class="reference internal" href="../syntax/types.html#syntax-memtype"><span class="std std-ref">memory type</span></a>
and takes one of two different shapes depending on whether that type is <a class="reference internal" href="../syntax/types.html#syntax-shared"><span class="std std-ref">shared</span></a> or not.
It is an invariant of the semantics that the shape always matches the type.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(memory instance)} &amp; \href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}} &amp;::=&amp;
  \{ \href{../exec/runtime.html#syntax-meminst}{\mathsf{type}}~\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}, \href{../exec/runtime.html#syntax-meminst}{\mathsf{data}}~\href{../syntax/conventions.html#syntax-vec}{\mathit{vec}}(\href{../syntax/values.html#syntax-byte}{\mathit{byte}}) \} \\ &amp;&amp;|&amp;
  \{ \href{../exec/runtime.html#syntax-meminst}{\mathsf{type}}~\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}} \} \\
\end{array}\end{split}\]</div>
<p>The instance of a memory with <a class="reference internal" href="../syntax/types.html#syntax-unshared"><span class="std std-ref">unshared</span></a> <a class="reference internal" href="../syntax/types.html#syntax-memtype"><span class="std std-ref">type</span></a> holds a vector of <a class="reference internal" href="../syntax/values.html#syntax-byte"><span class="std std-ref">bytes</span></a> directly representing its state.
The length of the vector always is a multiple of the WebAssembly <em>page size</em>, which is defined to be the constant <span class="math notranslate nohighlight">\(65536\)</span> – abbreviated <span class="math notranslate nohighlight">\(64\,\mathrm{Ki}\)</span>.
The bytes can be mutated through <a class="reference internal" href="../syntax/instructions.html#syntax-instr-memory"><span class="std std-ref">memory instructions</span></a>, the execution of an active <a class="reference internal" href="../syntax/modules.html#syntax-data"><span class="std std-ref">data segment</span></a>, or by external means provided by the <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a>.
It is an invariant of the semantics that the length of the byte vector, divided by page size, never exceeds the maximum size of <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}\)</span>, if present.</p>
<p>For memories of <a class="reference internal" href="../syntax/types.html#syntax-shared"><span class="std std-ref">shared</span></a> <a class="reference internal" href="../syntax/types.html#syntax-memtype"><span class="std std-ref">type</span></a>, no state is recorded in the instance itself.
Instead of representing the contents of a memory directly the abstract machine hence separately records <a class="reference internal" href="relaxed.html#relaxed-trace"><span class="std std-ref">traces</span></a> of corresponding memory <a class="reference internal" href="#syntax-evt"><span class="std std-ref">events</span></a> that describe all accesses that occur.</p>
</div>
<div class="section" id="global-instances">
<span id="syntax-globalinst"></span><span id="index-11"></span><h2>Global Instances<a class="headerlink" href="#global-instances" title="Permalink to this headline">¶</a></h2>
<p>A <em>global instance</em> is the runtime representation of a <a class="reference internal" href="../syntax/modules.html#syntax-global"><span class="std std-ref">global</span></a> variable.
It holds an individual <a class="reference internal" href="#syntax-val"><span class="std std-ref">value</span></a> and a flag indicating whether it is mutable.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(global instance)} &amp; \href{../exec/runtime.html#syntax-globalinst}{\mathit{globalinst}} &amp;::=&amp;
  \{ \href{../exec/runtime.html#syntax-globalinst}{\mathsf{value}}~\href{../exec/runtime.html#syntax-val}{\mathit{val}}, \href{../exec/runtime.html#syntax-globalinst}{\mathsf{mut}}~\href{../syntax/types.html#syntax-mut}{\mathit{mut}} \} \\
\end{array}\end{split}\]</div>
<p>The value of mutable globals can be mutated through <a class="reference internal" href="../syntax/instructions.html#syntax-instr-variable"><span class="std std-ref">variable instructions</span></a> or by external means provided by the <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a>.</p>
</div>
<div class="section" id="export-instances">
<span id="syntax-exportinst"></span><span id="index-12"></span><h2>Export Instances<a class="headerlink" href="#export-instances" title="Permalink to this headline">¶</a></h2>
<p>An <em>export instance</em> is the runtime representation of an <a class="reference internal" href="../syntax/modules.html#syntax-export"><span class="std std-ref">export</span></a>.
It defines the export’s <a class="reference internal" href="../syntax/values.html#syntax-name"><span class="std std-ref">name</span></a> and the associated <a class="reference internal" href="#syntax-externval"><span class="std std-ref">external value</span></a>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(export instance)} &amp; \href{../exec/runtime.html#syntax-exportinst}{\mathit{exportinst}} &amp;::=&amp;
  \{ \href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}~\href{../syntax/values.html#syntax-name}{\mathit{name}}, \href{../exec/runtime.html#syntax-exportinst}{\mathsf{value}}~\href{../exec/runtime.html#syntax-externval}{\mathit{externval}} \} \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="external-instances">
<span id="syntax-externinst"></span><span id="index-13"></span><h2>External Instances<a class="headerlink" href="#external-instances" title="Permalink to this headline">¶</a></h2>
<p>An <em>external instance</em> is an instance that can be imported or exported,
i.e., either a <a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">function instance</span></a>, <a class="reference internal" href="#syntax-tableinst"><span class="std std-ref">table instance</span></a>, <a class="reference internal" href="#syntax-meminst"><span class="std std-ref">memory instance</span></a>, or <a class="reference internal" href="#syntax-globalinst"><span class="std std-ref">global instances</span></a>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llcl}
\def\mathdef1548#1{{}}\mathdef1548{(external instance)} &amp; \href{../exec/runtime.html#syntax-externinst}{\mathit{externinst}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-funcinst}{\mathit{funcinst}} ~|~
  \href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}} ~|~
  \href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}} ~|~
  \href{../exec/runtime.html#syntax-globalinst}{\mathit{globalinst}} \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="external-values">
<span id="syntax-externval"></span><span id="index-14"></span><h2>External Values<a class="headerlink" href="#external-values" title="Permalink to this headline">¶</a></h2>
<p>An <em>external value</em> is the address of an <a class="reference internal" href="#syntax-externinst"><span class="std std-ref">external instance</span></a>.
Consequently, it is either a <a class="reference internal" href="#syntax-funcaddr"><span class="std std-ref">function address</span></a>, <a class="reference internal" href="#syntax-tableaddr"><span class="std std-ref">table address</span></a>, <a class="reference internal" href="#syntax-memaddr"><span class="std std-ref">memory address</span></a>, or <a class="reference internal" href="#syntax-globaladdr"><span class="std std-ref">global address</span></a>, denoting a respecive instance in the shared <a class="reference internal" href="#syntax-store"><span class="std std-ref">store</span></a>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llcl}
\def\mathdef1548#1{{}}\mathdef1548{(external value)} &amp; \href{../exec/runtime.html#syntax-externval}{\mathit{externval}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-externval}{\mathsf{func}}~\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}} \\&amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-externval}{\mathsf{table}}~\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}} \\&amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-externval}{\mathsf{mem}}~\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}} \\&amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-externval}{\mathsf{global}}~\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}} \\
\end{array}\end{split}\]</div>
<div class="section" id="id8">
<h3>Conventions<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>The following auxiliary notation is defined for sequences of external values.
It filters out entries of a specific kind in an order-preserving fashion:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-externval}{\mathrm{funcs}}(\href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast) = [\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}} ~|~ (\href{../exec/runtime.html#syntax-externval}{\mathsf{func}}~\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}) \in \href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast]\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-externval}{\mathrm{tables}}(\href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast) = [\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}} ~|~ (\href{../exec/runtime.html#syntax-externval}{\mathsf{table}}~\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}) \in \href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast]\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-externval}{\mathrm{mems}}(\href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast) = [\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}} ~|~ (\href{../exec/runtime.html#syntax-externval}{\mathsf{mem}}~\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}) \in \href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast]\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-externval}{\mathrm{globals}}(\href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast) = [\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}} ~|~ (\href{../exec/runtime.html#syntax-externval}{\mathsf{global}}~\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}) \in \href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast]\)</span></p></li>
</ul>
</div>
</div>
<div class="section" id="stack">
<span id="label"></span><span id="frame"></span><span id="syntax-label"></span><span id="syntax-frame"></span><span id="index-15"></span><span id="id9"></span><h2>Stack<a class="headerlink" href="#stack" title="Permalink to this headline">¶</a></h2>
<p>Besides the <a class="reference internal" href="#store"><span class="std std-ref">store</span></a>, most <a class="reference internal" href="../syntax/instructions.html#syntax-instr"><span class="std std-ref">instructions</span></a> interact with an implicit <em>stack</em>.
The stack contains three kinds of entries:</p>
<ul class="simple">
<li><p><em>Values</em>: the <em>operands</em> of instructions.</p></li>
<li><p><em>Labels</em>: active <a class="reference internal" href="../syntax/instructions.html#syntax-instr-control"><span class="std std-ref">structured control instructions</span></a> that can be targeted by branches.</p></li>
<li><p><em>Activations</em>: the <em>call frames</em> of active <a class="reference internal" href="../syntax/modules.html#syntax-func"><span class="std std-ref">function</span></a> calls.</p></li>
</ul>
<p>These entries can occur on the stack in any order during the execution of a program.
Stack entries are described by abstract syntax as follows.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to model the WebAssembly semantics using separate stacks for operands, control constructs, and calls.
However, because the stacks are interdependent, additional book keeping about associated stack heights would be required.
For the purpose of this specification, an interleaved representation is simpler.</p>
</div>
<div class="section" id="id10">
<h3>Values<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Values are represented by <a class="reference internal" href="#syntax-val"><span class="std std-ref">themselves</span></a>.</p>
</div>
<div class="section" id="labels">
<h3>Labels<a class="headerlink" href="#labels" title="Permalink to this headline">¶</a></h3>
<p>Labels carry an argument arity <span class="math notranslate nohighlight">\(n\)</span> and their associated branch <em>target</em>, which is expressed syntactically as an <a class="reference internal" href="../syntax/instructions.html#syntax-instr"><span class="std std-ref">instruction</span></a> sequence:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(label)} &amp; \href{../exec/runtime.html#syntax-label}{\mathit{label}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-label}{\mathsf{label}}_n\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\} \\
\end{array}\end{split}\]</div>
<p>Intuitively, <span class="math notranslate nohighlight">\(\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\)</span> is the <em>continuation</em> to execute when the branch is taken, in place of the original control construct.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For example, a loop label has the form</p>
<div class="math notranslate nohighlight">
\[\href{../exec/runtime.html#syntax-label}{\mathsf{label}}_n\{\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{loop}}~\dots~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}}\}\]</div>
<p>When performing a branch to this label, this executes the loop, effectively restarting it from the beginning.
Conversely, a simple block label has the form</p>
<div class="math notranslate nohighlight">
\[\href{../exec/runtime.html#syntax-label}{\mathsf{label}}_n\{\epsilon\}\]</div>
<p>When branching, the empty continuation ends the targeted block, such that execution can proceed with consecutive instructions.</p>
</div>
</div>
<div class="section" id="activations-and-frames">
<h3>Activations and Frames<a class="headerlink" href="#activations-and-frames" title="Permalink to this headline">¶</a></h3>
<p>Activation frames carry the return arity <span class="math notranslate nohighlight">\(n\)</span> of the respective function,
hold the values of its <a class="reference internal" href="../syntax/modules.html#syntax-local"><span class="std std-ref">locals</span></a> (including arguments) in the order corresponding to their static <a class="reference internal" href="../syntax/modules.html#syntax-localidx"><span class="std std-ref">local indices</span></a>,
and a reference to the function’s own <a class="reference internal" href="#syntax-moduleinst"><span class="std std-ref">module instance</span></a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(activation)} &amp; \mathit{activation} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-frame}{\mathsf{frame}}_n\{\href{../exec/runtime.html#syntax-frame}{\mathit{frame}}\} \\
\def\mathdef1548#1{{}}\mathdef1548{(frame)} &amp; \href{../exec/runtime.html#syntax-frame}{\mathit{frame}} &amp;::=&amp;
  \{ \href{../exec/runtime.html#syntax-frame}{\mathsf{locals}}~\href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast, \href{../exec/runtime.html#syntax-frame}{\mathsf{module}}~\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}} \} \\
\end{array}\end{split}\]</div>
<p>The values of the locals are mutated by respective <a class="reference internal" href="../syntax/instructions.html#syntax-instr-variable"><span class="std std-ref">variable instructions</span></a>.</p>
</div>
<div class="section" id="exec-expand">
<span id="id11"></span><h3>Conventions<a class="headerlink" href="#exec-expand" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The meta variable <span class="math notranslate nohighlight">\(L\)</span> ranges over labels where clear from context.</p></li>
<li><p>The meta variable <span class="math notranslate nohighlight">\(F\)</span> ranges over frames where clear from context.</p></li>
<li><p>The following auxiliary definition takes a <a class="reference internal" href="../syntax/instructions.html#syntax-blocktype"><span class="std std-ref">block type</span></a> and looks up the <a class="reference internal" href="../syntax/types.html#syntax-functype"><span class="std std-ref">function type</span></a> that it denotes in the current frame:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lll}
\href{../exec/runtime.html#exec-expand}{\mathrm{expand}}_F(\href{../syntax/modules.html#syntax-typeidx}{\mathit{typeidx}}) &amp;=&amp; F.\href{../exec/runtime.html#syntax-frame}{\mathsf{module}}.\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{types}}[\href{../syntax/modules.html#syntax-typeidx}{\mathit{typeidx}}] \\
\href{../exec/runtime.html#exec-expand}{\mathrm{expand}}_F([\href{../syntax/types.html#syntax-valtype}{\mathit{valtype}}^?]) &amp;=&amp; [] \href{../syntax/types.html#syntax-functype}{\rightarrow} [\href{../syntax/types.html#syntax-valtype}{\mathit{valtype}}^?] \\
\end{array}\end{split}\]</div>
</div>
</div>
<div class="section" id="administrative-instructions">
<span id="syntax-instr-admin"></span><span id="syntax-suspend"></span><span id="syntax-init-data"></span><span id="syntax-init-elem"></span><span id="syntax-invoke"></span><span id="syntax-trap"></span><span id="index-16"></span><h2>Administrative Instructions<a class="headerlink" href="#administrative-instructions" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is only relevant for the <a class="reference internal" href="conventions.html#exec-notation"><span class="std std-ref">formal notation</span></a>.</p>
</div>
<p>In order to express the reduction of <a class="reference internal" href="../intro/overview.html#trap"><span class="std std-ref">traps</span></a>, <a class="reference internal" href="../syntax/instructions.html#syntax-call"><span class="std std-ref">calls</span></a>, and <a class="reference internal" href="../syntax/instructions.html#syntax-instr-control"><span class="std std-ref">control instructions</span></a>, the syntax of instructions is extended to include the following <em>administrative instructions</em>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llcl}
\def\mathdef1548#1{{}}\mathdef1548{(administrative instruction)} &amp; \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}} &amp;::=&amp;
  \dots \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-trap}{\mathsf{trap}} \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-invoke}{\mathsf{invoke}}~\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}} \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-init-elem}{\mathsf{init\_elem}}~\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}~\href{../syntax/values.html#syntax-int}{\mathit{u32}}~\href{../syntax/modules.html#syntax-funcidx}{\mathit{funcidx}}^\ast \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-init-data}{\mathsf{init\_data}}~\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}~\href{../syntax/values.html#syntax-int}{\mathit{u32}}~\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-label}{\mathsf{label}}_n\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\}~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-frame}{\mathsf{frame}}_n\{\href{../exec/runtime.html#syntax-frame}{\mathit{frame}}\}~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-waitx}{\mathsf{wait'}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~n \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-notifyx}{\mathsf{notify'}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~n~m \\
\end{array}\end{split}\]</div>
<p>The <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-trap}{\mathsf{trap}}\)</span> instruction represents the occurrence of a trap.
Traps are bubbled up through nested instruction sequences, ultimately reducing the entire program to a single <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-trap}{\mathsf{trap}}\)</span> instruction, signalling abrupt termination.</p>
<p>The <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-invoke}{\mathsf{invoke}}\)</span> instruction represents the imminent invocation of a <a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">function instance</span></a>, identified by its <a class="reference internal" href="#syntax-funcaddr"><span class="std std-ref">address</span></a>.
It unifies the handling of different forms of calls.</p>
<p>The <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-init-elem}{\mathsf{init\_elem}}\)</span> and <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-init-data}{\mathsf{init\_data}}\)</span> instructions perform initialization of <a class="reference internal" href="../syntax/modules.html#syntax-elem"><span class="std std-ref">element</span></a> and <a class="reference internal" href="../syntax/modules.html#syntax-data"><span class="std std-ref">data</span></a> segments during module <a class="reference internal" href="modules.html#exec-instantiation"><span class="std std-ref">instantiation</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The reason for splitting instantiation into individual reduction steps is to provide a semantics that is compatible with future extensions like threads.</p>
</div>
<p>The <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-label}{\mathsf{label}}\)</span> and <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-frame}{\mathsf{frame}}\)</span> instructions model <a class="reference internal" href="#syntax-label"><span class="std std-ref">labels</span></a> and <a class="reference internal" href="#syntax-frame"><span class="std std-ref">frames</span></a> <a class="reference internal" href="conventions.html#exec-notation"><span class="std std-ref">“on the stack”</span></a>.
Moreover, the administrative syntax maintains the nesting structure of the original <a class="reference internal" href="../syntax/instructions.html#syntax-instr-control"><span class="std std-ref">structured control instruction</span></a> or <a class="reference internal" href="../syntax/modules.html#syntax-func"><span class="std std-ref">function body</span></a> and their <a class="reference internal" href="../syntax/instructions.html#syntax-instr-seq"><span class="std std-ref">instruction sequences</span></a> with an <span class="math notranslate nohighlight">\(\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}}\)</span> marker.
That way, the end of the inner instruction sequence is known when part of an outer sequence.</p>
<div class="admonition-todo admonition" id="id12">
<p class="admonition-title">Todo</p>
<p>describe <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-waitx}{\mathsf{wait'}}\)</span> and <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-notifyx}{\mathsf{notify'}}\)</span></p>
</div>
<div class="admonition-todo admonition" id="id13">
<p class="admonition-title">Todo</p>
<p>add allocation instructions</p>
</div>
<div class="admonition-todo admonition" id="id14">
<p class="admonition-title">Todo</p>
<p>add host instruction</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For example, the <a class="reference internal" href="instructions.html#exec-block"><span class="std std-ref">reduction rule</span></a> for <span class="math notranslate nohighlight">\(\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{block}}\)</span> is:</p>
<div class="math notranslate nohighlight">
\[\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{block}}~[t^n]~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \quad\href{../exec/conventions.html#formal-notation}{\hookrightarrow}\quad
\href{../exec/runtime.html#syntax-label}{\mathsf{label}}_n\{\epsilon\}~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}}\]</div>
<p>This replaces the block with a label instruction,
which can be interpreted as “pushing” the label on the stack.
When <span class="math notranslate nohighlight">\(\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}}\)</span> is reached, i.e., the inner instruction sequence has been reduced to the empty sequence – or rather, a sequence of <span class="math notranslate nohighlight">\(n\)</span> <span class="math notranslate nohighlight">\(\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}\)</span> instructions representing the resulting values – then the <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-label}{\mathsf{label}}\)</span> instruction is eliminated courtesy of its own <a class="reference internal" href="instructions.html#exec-label"><span class="std std-ref">reduction rule</span></a>:</p>
<div class="math notranslate nohighlight">
\[\href{../exec/runtime.html#syntax-label}{\mathsf{label}}_m\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\}~\href{../exec/runtime.html#syntax-val}{\mathit{val}}^n~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \quad\href{../exec/conventions.html#formal-notation}{\hookrightarrow}\quad \href{../exec/runtime.html#syntax-val}{\mathit{val}}^n\]</div>
<p>This can be interpreted as removing the label from the stack and only leaving the locally accumulated operand values.</p>
</div>
<div class="section" id="block-contexts">
<span id="syntax-ctxt-block"></span><span id="index-17"></span><h3>Block Contexts<a class="headerlink" href="#block-contexts" title="Permalink to this headline">¶</a></h3>
<p>In order to specify the reduction of <a class="reference internal" href="../syntax/instructions.html#syntax-instr-control"><span class="std std-ref">branches</span></a>, the following syntax of <em>block contexts</em> is defined, indexed by the count <span class="math notranslate nohighlight">\(k\)</span> of labels surrounding a <em>hole</em> <span class="math notranslate nohighlight">\([\_]\)</span> that marks the place where the next step of computation is taking place:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(block contexts)} &amp; \href{../exec/runtime.html#syntax-ctxt-block}{B}^0 &amp;::=&amp;
  \href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast~[\_]~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast \\
\def\mathdef1548#1{{}}\mathdef1548{(block contexts)} &amp; \href{../exec/runtime.html#syntax-ctxt-block}{B}^{k+1} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast~\href{../exec/runtime.html#syntax-label}{\mathsf{label}}_n\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\}~\href{../exec/runtime.html#syntax-ctxt-block}{B}^k~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}}~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast \\
\end{array}\end{split}\]</div>
<p>This definition allows to index active labels surrounding a <a class="reference internal" href="../syntax/instructions.html#syntax-br"><span class="std std-ref">branch</span></a> or <a class="reference internal" href="../syntax/instructions.html#syntax-return"><span class="std std-ref">return</span></a> instruction.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For example, the <a class="reference internal" href="instructions.html#exec-br"><span class="std std-ref">reduction</span></a> of a simple branch can be defined as follows:</p>
<div class="math notranslate nohighlight">
\[\href{../exec/runtime.html#syntax-label}{\mathsf{label}}_0\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\}~\href{../exec/runtime.html#syntax-ctxt-block}{B}^l[\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{br}}~l]~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \quad\href{../exec/conventions.html#formal-notation}{\hookrightarrow}\quad \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\]</div>
<p>Here, the hole <span class="math notranslate nohighlight">\([\_]\)</span> of the context is instantiated with a branch instruction.
When a branch occurs,
this rule replaces the targeted label and associated instruction sequence with the label’s continuation.
The selected label is identified through the <a class="reference internal" href="../syntax/modules.html#syntax-labelidx"><span class="std std-ref">label index</span></a> <span class="math notranslate nohighlight">\(l\)</span>, which corresponds to the number of surrounding <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-label}{\mathsf{label}}\)</span> instructions that must be hopped over – which is exactly the count encoded in the index of a block context.</p>
</div>
</div>
</div>
<div class="section" id="events">
<span id="syntax-storeval"></span><span id="syntax-fld"></span><span id="syntax-loc"></span><span id="syntax-ord"></span><span id="syntax-act"></span><span id="syntax-evt"></span><span id="index-18"></span><h2>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h2>
<p>The interaction of a computation with the <a class="reference internal" href="#syntax-sharedstore"><span class="std std-ref">shared store</span></a> is described through <em>events</em>.
An event is a (possibly empty) set of <em>actions</em>, such as reads and writes,
that are atomically performed by the execution of an individual <a class="reference internal" href="../syntax/instructions.html#syntax-instr"><span class="std std-ref">instruction</span></a>.
Each event is annotated with a <a class="reference internal" href="#syntax-time"><span class="std std-ref">time stamp</span></a> that uniquely identifies it.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llcl}
\def\mathdef1548#1{{}}\mathdef1548{(event)} &amp; \href{../exec/runtime.html#syntax-evt}{\mathit{evt}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-act}{\mathit{act}}^\ast~\href{../exec/runtime.html#syntax-time}{\mathsf{at}}~\href{../exec/runtime.html#syntax-time}{\mathit{time}} \\
\def\mathdef1548#1{{}}\mathdef1548{(action)} &amp; \href{../exec/runtime.html#syntax-act}{\mathit{act}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-act}{\mathsf{rd}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../exec/runtime.html#syntax-storeval}{\mathit{storeval}} \\&amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-act}{\mathsf{wr}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../exec/runtime.html#syntax-storeval}{\mathit{storeval}} \\&amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-act}{\mathsf{rmw}}~\href{../exec/runtime.html#syntax-loc}{\mathit{loc}}~\href{../exec/runtime.html#syntax-storeval}{\mathit{storeval}}~\href{../exec/runtime.html#syntax-storeval}{\mathit{storeval}} \\&amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-act}{\mathit{hostact}} \\
\def\mathdef1548#1{{}}\mathdef1548{(ordering)} &amp; \href{../exec/runtime.html#syntax-ord}{\mathit{ord}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-ord}{\mathsf{unord}} ~|~
  \href{../exec/runtime.html#syntax-ord}{\mathsf{seqcst}} \\
\def\mathdef1548#1{{}}\mathdef1548{(location)} &amp; \href{../exec/runtime.html#syntax-loc}{\mathit{loc}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-addr}{\mathit{addr}}.\href{../exec/runtime.html#syntax-fld}{\mathit{fld}} \\
\def\mathdef1548#1{{}}\mathdef1548{(field)} &amp; \href{../exec/runtime.html#syntax-fld}{\mathit{fld}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-loc}{\mathsf{len}} ~|~
  \href{../exec/runtime.html#syntax-loc}{\mathsf{data}}[\href{../syntax/values.html#syntax-int}{\mathit{u32}}] \\
\def\mathdef1548#1{{}}\mathdef1548{(store value)} &amp; \href{../exec/runtime.html#syntax-storeval}{\mathit{storeval}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-val}{\mathit{val}} ~|~
  b^\ast \\
\end{array}\end{split}\]</div>
<p>The access of <em>mutable</em> shared state is performed through the <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-act}{\mathsf{rd}}\)</span>, <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-act}{\mathsf{wr}}\)</span>, and <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-act}{\mathsf{rmw}}\)</span> actions.
They each access an <a class="reference internal" href="#syntax-externinst"><span class="std std-ref">external instance</span></a> at an abstract <em>location</em>.
Such a location consists of an <a class="reference internal" href="#syntax-addr"><span class="std std-ref">address</span></a> of a <a class="reference internal" href="../syntax/types.html#syntax-shared"><span class="std std-ref">shared</span></a> <a class="reference internal" href="#syntax-meminst"><span class="std std-ref">memory</span></a> instance and a symbolic <em>field</em> name in the respective object.
This is either <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-loc}{\mathsf{len}}\)</span> for the size or <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-loc}{\mathsf{data}}\)</span> for the vector of bytes.</p>
<p>In each case, read and write actions record the <em>store value</em> that has been read or written, which is either a regular <a class="reference internal" href="#syntax-val"><span class="std std-ref">value</span></a> or a sequence of <a class="reference internal" href="../syntax/values.html#syntax-byte"><span class="std std-ref">bytes</span></a>, depending on the location accessed.
An <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-act}{\mathsf{rmw}}\)</span> event, performing an atomic read-modify-write access, records both the store values read (first) and written (second);
it is an invariant of the semantics that both are either regular values of the same type or byte sequences of the same length.</p>
<p><span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-act}{\mathsf{rd}}\)</span> and <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-act}{\mathsf{wr}}\)</span> events are further annotated by a memory <em>ordering</em>, which describes whether the access is <em>unordered</em>, as e.g. performed by a regular <a class="reference internal" href="../syntax/instructions.html#syntax-instr-memory"><span class="std std-ref">load or store instruction</span></a>, or <em>sequentially consistent</em>, as e.g. performed by <a class="reference internal" href="../syntax/instructions.html#syntax-instr-atomic-memory"><span class="std std-ref">atomic memory instructions</span></a>.
A <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-act}{\mathsf{rmw}}\)</span> action always is sequentially consistent.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Future versions of WebAssembly may introduce additional orderings.</p>
</div>
<p>Finally, a <em>host action</em> is an action performed outside of WebAssembly code.
Its form and meaning is outside the scope of this specification.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a> may define a custom set of host actions and respective ordering constraints to model other forms of interactions that are not expressible within WebAssembly, but whose ordering relative to WebAssembly events is relevant for the combined semantics.</p>
</div>
<div class="section" id="convention">
<h3>Convention<a class="headerlink" href="#convention" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The actions <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-act}{\mathsf{rd}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}\)</span> and <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-act}{\mathsf{wr}}_{\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}}\)</span> are abbreviated to :math:just <cite>ARD</cite> and <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-act}{\mathsf{wr}}\)</span> when <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-ord}{\mathit{ord}}\)</span> is <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-ord}{\mathsf{unord}}\)</span>.</p></li>
</ul>
<div class="admonition-todo admonition" id="id15">
<p class="admonition-title">Todo</p>
<p>define notational shorthands over actions and events (or better put that in relaxed.rst?)</p>
</div>
</div>
</div>
<div class="section" id="configurations">
<span id="syntax-config"></span><span id="syntax-thread"></span><span id="index-19"></span><h2>Configurations<a class="headerlink" href="#configurations" title="Permalink to this headline">¶</a></h2>
<p>A <em>global configuration</em> describes the overall state of the abstract machine.
It consists of the current <a class="reference internal" href="#syntax-sharedstore"><span class="std std-ref">shared store</span></a> and a set of executing <em>threads</em>.</p>
<p>A thread consists of a local <a class="reference internal" href="#syntax-store"><span class="std std-ref">store</span></a> and a computation over a sequence of remaining <a class="reference internal" href="../syntax/instructions.html#syntax-instr"><span class="std std-ref">instructions</span></a>, <a class="reference internal" href="#notation-attime"><span class="std std-ref">annotated</span></a> with the <a class="reference internal" href="#syntax-time"><span class="std std-ref">time</span></a> it was last active.</p>
<p>A <em>local configuration</em> describes the state of an active function.
It consists of the local <a class="reference internal" href="#syntax-store"><span class="std std-ref">store</span></a> of the respective thread, the <a class="reference internal" href="#syntax-frame"><span class="std std-ref">frame</span></a> of the function, and the sequence of remaining <a class="reference internal" href="../syntax/instructions.html#syntax-instr"><span class="std std-ref">instructions</span></a> in that function.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llcl}
\def\mathdef1548#1{{}}\mathdef1548{(global configuration)} &amp; \href{../exec/runtime.html#syntax-config}{\mathit{config}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-sharedstore}{\mathit{sharedstore}}; \href{../exec/runtime.html#syntax-thread}{\mathit{thread}}^\ast \\
\def\mathdef1548#1{{}}\mathdef1548{(thread)} &amp; \href{../exec/runtime.html#syntax-thread}{\mathit{thread}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-store}{\mathit{store}}; \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast~\href{../exec/runtime.html#syntax-time}{\mathsf{at}}~\href{../exec/runtime.html#syntax-time}{\mathit{time}} \\
\def\mathdef1548#1{{}}\mathdef1548{(local configuration)} &amp; \href{../exec/runtime.html#syntax-config}{\mathit{lconfig}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-store}{\mathit{store}}; \href{../exec/runtime.html#syntax-frame}{\mathit{frame}}; \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast \\
\end{array}\end{split}\]</div>
<p>A thread has <em>terminated</em> when its instruction sequence has been reduced to a <a class="reference internal" href="#syntax-result"><span class="std std-ref">result</span></a>,
that is, either a sequence of <a class="reference internal" href="#syntax-val"><span class="std std-ref">values</span></a> or to a <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-trap}{\mathsf{trap}}\)</span>.</p>
<div class="section" id="id16">
<h3>Convention<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The meta variable <span class="math notranslate nohighlight">\(P\)</span> ranges over threads where clear from context.</p></li>
</ul>
</div>
</div>
<div class="section" id="reduction">
<span id="index-20"></span><h2>Reduction<a class="headerlink" href="#reduction" title="Permalink to this headline">¶</a></h2>
<p>Formally, WebAssembly computation is defined by two <em>small-step reduction</em> relations on global and local <a class="reference internal" href="#syntax-config"><span class="std std-ref">configurations</span></a>
that define how a single step of execution modifies these configurations, respectively.</p>
<div class="section" id="global-reduction">
<h3>Global Reduction<a class="headerlink" href="#global-reduction" title="Permalink to this headline">¶</a></h3>
<p><em>Global reduction</em> is concerned with allocation in the global store and synchronization between multiple <a class="reference internal" href="#syntax-thread"><span class="std std-ref">threads</span></a>.
It emits a (possibly empty) set of events that are produced by the corresponding step of computation.</p>
<p>Formally, glboal reduction is a relation</p>
<div class="math notranslate nohighlight">
\[\href{../exec/runtime.html#syntax-config}{\mathit{config}} \href{../exec/conventions.html#formal-notation}{\hookrightarrow}^{\href{../exec/runtime.html#syntax-evt}{\mathit{evt}}^\ast} \href{../exec/runtime.html#syntax-config}{\mathit{config}}\]</div>
<p>defined by inductive rewrite rules on global configurations.</p>
<p>The following structural rule for global reduction delegates to local reduction for single thread execution:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{&#64;{}c&#64;{}}
\mathit{SS}; P_1^\ast~(S; \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast \href{../exec/runtime.html#syntax-time}{\mathsf{at}} h)~P_2^\ast
  \qquad \href{../exec/conventions.html#formal-notation}{\hookrightarrow}^{\href{../exec/runtime.html#syntax-act}{\mathit{act}}^\ast \href{../exec/runtime.html#syntax-time}{\mathsf{at}} h'} \qquad
  \mathit{SS}; P_1^\ast~(S'; {\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}'}^\ast \href{../exec/runtime.html#syntax-time}{\mathsf{at}} h')~P_2^\ast \\
  \qquad (
    \begin{array}[t]{&#64;{}r&#64;{~}l&#64;{}}
    \mathrel{\mbox{if}} &amp; S; F_\epsilon; \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast \href{../exec/conventions.html#formal-notation}{\hookrightarrow}^{\href{../exec/runtime.html#syntax-act}{\mathit{act}}^\ast} S'; F'; {\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}'}^\ast) \\
    \wedge &amp; h \href{../exec/relaxed.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} h' \\
    \wedge &amp; (S(\href{../exec/runtime.html#syntax-addr}{\mathit{addr}}(\href{../exec/runtime.html#syntax-act}{\mathit{act}})).\href{../exec/runtime.html#syntax-time}{\mathsf{time}} \href{../exec/relaxed.html#relaxed-prechb}{\mathrel{\prec_{\mathsf{hb}}}} h')^\ast \\
    \wedge &amp; F_\epsilon = \{\href{../exec/runtime.html#syntax-frame}{\mathsf{module}}~\{\}\}) \\
    \end{array}
\end{array}\end{split}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="#syntax-time"><span class="std std-ref">time stamp</span></a> <span class="math notranslate nohighlight">\(h'\)</span> indicates the point in time at which the computation step takes place,
marking both the emitted atomic event and the updated time of the thread.
This time stamp is chosen non-deterministically in the rule.
However, the second side condition ensures that the time <span class="math notranslate nohighlight">\(h\)</span> of the last activity of the thread <em>happened before</em> <span class="math notranslate nohighlight">\(h'\)</span>, thereby imposing <em>program order</em> for any events originating from the same thread.
Similarly, the third side condition ensures that the allocation of any object accessed <em>happened before</em> <span class="math notranslate nohighlight">\(h'\)</span>, ensuring causality and preventing use before definition.</p>
<p>The empty <a class="reference internal" href="#syntax-frame"><span class="std std-ref">frame</span></a> <span class="math notranslate nohighlight">\(F_\epsilon\)</span> is a dummy for initiating the reduction globally.
It is an invariant of the semantics that it will never be accessed,
because no local definitions are defined outside a function.</p>
</div>
</div>
<div class="section" id="local-reduction">
<h3>Local Reduction<a class="headerlink" href="#local-reduction" title="Permalink to this headline">¶</a></h3>
<p><em>Local reduction</em> defines the execution of individual <a class="reference internal" href="../syntax/instructions.html#syntax-instr"><span class="std std-ref">instructions</span></a>.
Each execution step can perform a (possibly empty) set of <a class="reference internal" href="#syntax-act"><span class="std std-ref">actions</span></a>.</p>
<p>Formally, this is described by a labelled relation</p>
<div class="math notranslate nohighlight">
\[\href{../exec/runtime.html#syntax-config}{\mathit{lconfig}} \href{../exec/conventions.html#formal-notation}{\hookrightarrow}^{\href{../exec/runtime.html#syntax-act}{\mathit{act}}^\ast} \href{../exec/runtime.html#syntax-config}{\mathit{lconfig}}\]</div>
<p>To avoid unnecessary clutter, the following conventions are employed in the notation for local reduction rules:</p>
<ul class="simple">
<li><p>The configuration’s store <span class="math notranslate nohighlight">\(S\)</span> is omitted from rules that do not touch it.</p></li>
<li><p>The configuration’s frame <span class="math notranslate nohighlight">\(F\)</span> is omitted from rules that do not touch it.</p></li>
</ul>
</div>
<div class="section" id="evaluation-contexts">
<span id="syntax-ctxt-eval"></span><span id="index-21"></span><h3>Evaluation Contexts<a class="headerlink" href="#evaluation-contexts" title="Permalink to this headline">¶</a></h3>
<p>The following definition of <em>evaluation context</em> and associated structural rules enable reduction inside instruction sequences and administrative forms as well as the propagation of traps:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef1548#1{{}}\mathdef1548{(evaluation contexts)} &amp; E &amp;::=&amp;
  [\_] ~|~
  \href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast~E~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast ~|~
  \href{../exec/runtime.html#syntax-label}{\mathsf{label}}_n\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\}~E~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \\
\end{array}\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{rcl}
S; F; E[\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast] &amp;\href{../exec/conventions.html#formal-notation}{\hookrightarrow}&amp; S'; F'; E[{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}'}^\ast] \\
  &amp;&amp; (\mathrel{\mbox{if}} S; F; \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast \href{../exec/conventions.html#formal-notation}{\hookrightarrow} S'; F'; {\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}'}^\ast) \\
S; F; \href{../exec/runtime.html#syntax-frame}{\mathsf{frame}}_n\{F'\}~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} &amp;\href{../exec/conventions.html#formal-notation}{\hookrightarrow}&amp; S'; F; \href{../exec/runtime.html#syntax-frame}{\mathsf{frame}}_n\{F''\}~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}'^\ast~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \\
  &amp;&amp; (\mathrel{\mbox{if}} S; F'; \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast \href{../exec/conventions.html#formal-notation}{\hookrightarrow} S'; F''; {\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}'}^\ast) \\[1ex]
S; F; E[\href{../exec/runtime.html#syntax-trap}{\mathsf{trap}}] &amp;\href{../exec/conventions.html#formal-notation}{\hookrightarrow}&amp; S; F; \href{../exec/runtime.html#syntax-trap}{\mathsf{trap}}
  \qquad (\mathrel{\mbox{if}} E \neq [\_]) \\
S; F; \href{../exec/runtime.html#syntax-frame}{\mathsf{frame}}_n\{F'\}~\href{../exec/runtime.html#syntax-trap}{\mathsf{trap}}~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} &amp;\href{../exec/conventions.html#formal-notation}{\hookrightarrow}&amp; S; F; \href{../exec/runtime.html#syntax-trap}{\mathsf{trap}} \\
\end{array}\end{split}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The restriction on evaluation contexts rules out contexts like <span class="math notranslate nohighlight">\([\_]\)</span> and <span class="math notranslate nohighlight">\(\epsilon~[\_]~\epsilon\)</span> for which <span class="math notranslate nohighlight">\(E[\href{../exec/runtime.html#syntax-trap}{\mathsf{trap}}] = \href{../exec/runtime.html#syntax-trap}{\mathsf{trap}}\)</span>.</p>
<p>For an example of reduction under evaluation contexts, consider the following instruction sequence.</p>
<div class="math notranslate nohighlight">
\[(\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~x_1)~(\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~x_2)~\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{neg}}~(\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~x_3)~\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{add}}~\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{mul}}\]</div>
<p>This can be decomposed into <span class="math notranslate nohighlight">\(E[(\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~x_2)~\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{neg}}]\)</span> where</p>
<div class="math notranslate nohighlight">
\[E = (\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~x_1)~[\_]~(\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~x_3)~\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{add}}~\href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{mul}}\]</div>
<p>Moreover, this is the <em>only</em> possible choice of evaluation context where the contents of the hole matches the left-hand side of a reduction rule.</p>
</div>
</div>
<div class="section" id="host-reduction">
<span id="index-22"></span><h3>Host Reduction<a class="headerlink" href="#host-reduction" title="Permalink to this headline">¶</a></h3>
<div class="admonition-todo admonition" id="id17">
<p class="admonition-title">Todo</p>
<p>define</p>
</div>
<dl class="footnote brackets">
<dt class="label" id="cite-oopsla2019"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>The semantics of shared stores is derived from the following article:
Conrad Watt, Andreas Rossberg, Jean Pichon-Pharabod. <a class="reference external" href="https://dl.acm.org/citation.cfm?id=3360559">Weakening WebAssembly</a>. Proceedings of the ACM on Programming Languages (OOPSLA 2019). ACM 2019.</p>
</dd>
</dl>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2017, WebAssembly Community Group.
      
    </div>

    

    
  </body>
</html>